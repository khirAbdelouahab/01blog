<app-header></app-header>

<article class="blog-article" *ngIf="post$ | async as postData">
    <div class="hero-section">
        @if(postData && postData.mediaUploads && postData.mediaUploads.length > 0 &&
        postData.mediaUploads[0].type.toString()=='Image' ) {
        <img [src]="'http://localhost:8080/api/media/file/' + postData.mediaUploads[0].id" alt="Blog hero image"
            class="hero-image">
        }

        <div class="hero-overlay"></div>
    </div>

    <div class="container">
        <header class="blog-header">
            <h1 class="blog-title">{{postData?.title}}</h1>
            <div class="author-section">
                <div class="author-info">
                    <div class="avatar" (click)="goToProfile(postData?.author?.username)">
                        <img [src]="'http://localhost:8080/api/profile/image/' + postData?.author?.username"
                            alt="John Doe">
                    </div>
                    <div class="author-details">
                        <p class="author-name">{{postData?.author?.fullname}}</p>
                        <p class="author-bio">@{{postData?.author?.username}}</p>
                    </div>
                </div>
                <div class="meta-info">
                    <span class="separator" (click)="toggleMenu()">â‹®</span>
                    <div [class]="isMenuOpened? 'dropdown-menu show':'dropdown-menu'">
                        @if (isAdmin || postData.createdByMe) {
                        <button class="dropdown-item" (click)="deletePost(postData.id)">delete post</button>
                        }

                        @if (postData.createdByMe) {
                        <button class="dropdown-item" (click)="editPost(postData?.id)">edit post</button>
                        }

                        @if (isAdmin && !postData.createdByMe) {
                        <button class="dropdown-item" (click)="banUser(postData.author)">{{
                            postData.author.state=='banned'? 'Unban':'ban'}} User</button>
                        <button class="dropdown-item" (click)="hidePost(postData.id)">hide post</button>
                        }
                    </div>
                </div>
            </div>
        </header>

        <div class="content-card">
            <div class="content-body">
                <p>{{ postData?.content}}</p>
            </div>
        </div>

        <section class="media-section">
            <h2 class="section-title">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                Media Gallery
            </h2>
            <div class="media-grid">
                @if(postData && postData.mediaUploads && postData.mediaUploads.length > 0) {
                @for(media of postData?.mediaUploads; track media?.id) {
                <!-- changed -->
                <div class="media-card">
                    <div class="media-container">
                        @if (media.type.toString() == 'Image') {
                        <img [src]="'http://localhost:8080/api/media/file/' + media?.id" alt="Workspace setup">
                        }@else {
                        <video [src]="'http://localhost:8080/api/media/file/' + media?.id" controls
                            class="post-video"></video>
                        }
                    </div>
                    <div class="media-caption">
                        <p>{{media?.content}}</p>
                    </div>
                </div>
                <!-- changed -->
                }
                }
            </div>
        </section>

        <div class="action-buttons">
            <button class="action-btn" (click)="onLike(postData.id)">
                <svg class="icon" viewBox="0 0 24 24" [attr.fill]="postLiked ? 'red' : 'none'"
                    [attr.stroke]="postLiked ? 'red' : 'currentColor'" stroke-width="2">
                    <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                    </path>
                </svg>
                Like
            </button>
            <button class="action-btn" (click)="onReport(postData.id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2Z"
                        stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round" />
                    <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round" />
                    <path d="M8 12L10 10L12 14L16 11" stroke="currentColor" stroke-width="1.5" fill="none"
                        stroke-linecap="round" stroke-linejoin="round" />
                    <circle cx="8" cy="12" r="1.5" fill="currentColor" />
                    <circle cx="10" cy="10" r="1.5" fill="currentColor" />
                    <circle cx="12" cy="14" r="1.5" fill="currentColor" />
                    <circle cx="16" cy="11" r="1.5" fill="currentColor" />
                    <line x1="8" y1="6" x2="12" y2="6" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" />
                    <line x1="8" y1="17" x2="16" y2="17" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" />
                    <line x1="8" y1="19" x2="14" y2="19" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" />
                </svg>
                Report
            </button>
        </div>

        <section class="comments-section">
            <h2 class="section-title">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Comments ({{postData?.comments?.length}})
            </h2>

            <div class="comments-list">
                <form id="editForm" class="about-form">
                    <div class="form-group">
                        <label for="aboutText">comment</label>
                        <textarea id="aboutText" name="commentContent" placeholder="comment on this blog..."
                            [(ngModel)]="commentContent"></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn-primary" (click)="onComment(postData.id)">Save</button>
                        <button class="btn-secondary" (click)="onCancel()">Cancel</button>
                    </div>
                </form>
                @if(postData && postData.comments && postData.comments.length > 0) {
                    @for(comment of postData.comments;track comment.id) {
                        <app-comment (onDeleteCommentEventHandler)="onDeleteComment($event)" [commentInfo]="comment"></app-comment>
                    }
                }
            </div>
        </section>
    </div>
</article>